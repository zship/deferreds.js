/*! deferreds.js v0.1 | MIT license */
(function(){var e,t,n;(function(r){function p(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)==="."&&t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function d(e,t){return function(){return s.apply(r,h.call(arguments,0).concat([e,t]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){a[e]=t}}function g(e){if(f.hasOwnProperty(e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!a.hasOwnProperty(e)&&!c.hasOwnProperty(e))throw new Error("No "+e);return a[e]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=[].slice;o=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return d(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:b(e)}}},i=function(e,t,n,i){var s,l,h,p,v,y=[],b;i=i||e;if(typeof n=="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(v=0;v<t.length;v+=1){p=o(t[v],i),l=p.f;if(l==="require")y[v]=u.require(e);else if(l==="exports")y[v]=u.exports(e),b=!0;else if(l==="module")s=y[v]=u.module(e);else if(a.hasOwnProperty(l)||f.hasOwnProperty(l)||c.hasOwnProperty(l))y[v]=g(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,d(i,!0),m(l),{}),y[v]=a[l]}}h=n.apply(a[e],y);if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!b)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){return typeof e=="string"?u[e]?u[e](t):g(o(e,t).f):(e.splice||(l=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},15),s)},s.config=function(e){return l=e,s},n=function(e,t,n){t.splice||(n=t,t=[]),f[e]=[e,t,n]},n.amd={jQuery:!0}})(),n("../lib/almond",function(){}),n("when",[],function(){function i(e,t,n,r){return s(e).then(t,n,r)}function s(e){var t,n;return e instanceof u?t=e:(e!==undefined&&typeof e.valueOf=="function"&&(e=e.valueOf()),c(e)?(n=l(),e.then(n.resolve,n.reject,n.progress),t=n.promise):t=a(e)),t}function o(e){return i(e,function(e){return f(e)})}function u(e){this.then=e}function a(t){var n=new u(function(e){try{return s(e?e(t):t)}catch(n){return f(n)}});return e(n)}function f(t){var n=new u(function(e,n){try{return n?s(n(t)):f(t)}catch(r){return f(r)}});return e(n)}function l(){function d(e,t,n){return a(e,t,n)}function v(e){return p(e)}function m(e){return p(f(e))}function g(e){c(e)}var t,n,i,o,a,c,p;return n=new u(d),t={then:d,resolve:v,reject:m,progress:g,notify:g,promise:e(n),resolver:e({resolve:v,reject:m,progress:g,notify:g})},i=[],o=[],a=function(e,t,n){var r=l();return i.push(function(n){n.then(e,t).then(r.resolve,r.reject,r.progress)}),n&&o.push(n),r.promise},c=function(e){var t,n=0;while(t=o[n++])t(e)},p=function(e){var t,n=0;e=s(e),a=e.then,p=s,c=h;while(t=i[n++])t(e);return o=i=r,e},t}function c(e){return e&&typeof e.then=="function"}function h(){}function p(e){return e}var e,t,n,r;return n=/^false$/i,t="WHEN_PARANOID",e=p,i.defer=l,i.resolve=s,i.reject=o,i.isPromise=c,u.prototype=e({always:function(e,t){return this.then(e,e,t)},otherwise:function(e){return this.then(r,e)},done:function(e){return this.then(e)},fail:function(e){return this.then(r,e)},progress:function(e){return this.then(r,r,e)}}),i}),n("amd-utils/lang/kindOf",[],function(){function r(r){return r===null?"Null":r===n?"Undefined":e.exec(t.call(r))[1]}var e=/^\[object (.*)\]$/,t=Object.prototype.toString,n;return r}),n("amd-utils/lang/isKind",["./kindOf"],function(e){function t(t,n){return e(t)===n}return t}),n("amd-utils/lang/isArray",["./isKind"],function(e){var t=Array.isArray||function(t){return e(t,"Array")};return t}),n("amd-utils/array/forEach",[],function(){function e(e,t,n){var r=-1,i=e.length>>>0;while(++r<i)r in e&&t.call(n,e[r],r,e)}return e}),n("amd-utils/array/map",["./forEach"],function(e){function t(t,n,r){var i=new Array(t.length);return e(t,function(e,t,s){i[t]=n.call(r,e,t,s)}),i}return t}),n("amd-utils/object/hasOwn",[],function(){function e(e,t){return Object.prototype.hasOwnProperty.call(e,t)}return e}),n("amd-utils/object/forOwn",["./hasOwn"],function(e){function r(){n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],t=!0;for(var e in{toString:null})t=!1}function i(e,i,o){var u,a=0;t==null&&r();for(u in e)s(i,e,u,o);if(t)while(u=n[a++])s(i,e,u,o)}function s(t,n,r,i){e(n,r)&&t.call(i,n[r],r,n)}var t,n;return i}),n("amd-utils/object/map",["./forOwn"],function(e){function t(t,n,r){var i={};return e(t,function(e,t,s){i[t]=n.call(r,e,t,s)}),i}return t}),n("collection/map",["amd-utils/lang/isArray","amd-utils/array/map","amd-utils/object/map"],function(e,t,n){function r(r,i,s){return e(r)?t(r,i,s):n(r,i,s)}return r}),n("collection/pluck",["./map"],function(e){function t(t,n){return e(t,function(e){return e[n]})}return t}),n("amd-utils/object/keys",["./forOwn"],function(e){var t=Object.keys||function(t){var n=[];return e(t,function(e,t){n.push(t)}),n};return t}),n("collection/size",["amd-utils/lang/isArray","amd-utils/object/keys"],function(e,t){function n(n){return n?e(n)?n.length:t(n).length:0}return n}),n("forEachSeries",["require","./when","amd-utils/lang/isArray","./collection/size","amd-utils/object/keys"],function(e){var t=e("./when"),n=e("amd-utils/lang/isArray"),r=e("./collection/size"),i=e("amd-utils/object/keys"),s=function(e,s){var o=t.defer();if(!r(e))return o.reject(),o;var u=0,a;n(e)||(a=i(e));var f=function(){var i,l;n(e)?(l=u,i=e[l]):(l=a[u],i=e[l]),t(s(i,l)).fail(function(){o.reject()}).done(function(){u+=1,u===r(e)?o.resolve():f()})};return f(),o.promise};return s}),n("filterSeries",["require","./when","./collection/map","./collection/pluck","./forEachSeries"],function(e){var t=e("./when"),n=e("./collection/map"),r=e("./collection/pluck"),i=e("./forEachSeries"),s=function(e,s,o){var u=t.defer(),a=[];return s=n(function(e,t){return{index:t,value:e}}),i(s,function(e){return t(o(e.value)).done(function(){a.push(e)})}).fail(function(){u.reject()}).done(function(){a=a.sort(function(e,t){return e.index-t.index}),a=r(a,"value"),u.resolve(a)}),u.promise};return s}),n("mapSeries",["require","./when","./collection/map","./forEachSeries"],function(e){var t=e("./when"),n=e("./collection/map"),r=e("./forEachSeries"),i=function(e,i,s){var o=t.defer(),u=[];return i=n(i,function(e,t){return{index:t,value:e}}),r(i,function(e){return t(s(e.value)).fail(function(t){u[e.index]=t}).done(function(t){u[e.index]=t})}).fail(function(e){o.reject(e)}).done(function(){o.resolve(u)}),o.promise};return i}),n("collection/forEach",["amd-utils/lang/isArray","amd-utils/array/forEach","amd-utils/object/forOwn"],function(e,t,n){function r(r,i,s){return e(r)?t(r,i,s):n(r,i,s)}return r}),n("forEach",["require","./when","./collection/forEach","./collection/size"],function(e){var t=e("./when"),n=e("./collection/forEach"),r=e("./collection/size"),i=function(e,i){var s=t.defer();if(!r(e))return s.reject(),s.promise;var o=0;return n(e,function(n,u){t(i(n,u)).fail(function(){s.reject()}).done(function(){o++,o===r(e)&&s.resolve()})}),s.promise};return i}),n("map",["require","./when","./collection/map","./forEach"],function(e){var t=e("./when"),n=e("./collection/map"),r=e("./forEach"),i=function(e,i,s){var o=t.defer(),u=[];return i=n(i,function(e,t){return{index:t,value:e}}),r(i,function(e){return t(s(e.value)).fail(function(t){u[e.index]=t}).done(function(t){u[e.index]=t})}).fail(function(e){o.reject(e)}).done(function(){o.resolve(u)}),o.promise};return i}),n("until",["require","./when"],function(e){var t=e("./when"),n=function(e,r){var i=t.defer();return e()?i.resolve():t(r()).fail(function(e){i.reject(e)}).done(function(){n(e,r)}),i.promise};return n}),n("amd-utils/lang/toArray",["./kindOf"],function(e){function n(n){var r=[],i=e(n),s;if(n!=null)if(n.length==null||i==="String"||i==="Function"||i==="RegExp"||n===t)r[r.length]=n;else{s=n.length;while(s--)r[s]=n[s]}return r}var t=this;return n}),n("amd-utils/lang/isFunction",["./isKind"],function(e){function t(t){return e(t,"Function")}return t}),n("anyToDeferred",["require","./when","amd-utils/lang/isFunction"],function(e){var t=e("./when"),n=e("amd-utils/lang/isFunction"),r=function(e){return e&&e.promise},i=function(e){var i=Array.prototype.slice.call(arguments,1);if(r(e))return t(e);if(n(e)){var s=e.apply(e,i);return t(s)}return t(e)};return i}),n("parallel",["require","./when","amd-utils/lang/isArray","amd-utils/lang/toArray","./anyToDeferred","./forEach","./map"],function(e){var t=e("./when"),n=e("amd-utils/lang/isArray"),r=e("amd-utils/lang/toArray"),i=e("./anyToDeferred"),s=e("./forEach"),o=e("./map"),u=function(e){var u=t.defer();arguments.length>1&&(e=r(arguments));if(n(e))o(e,function(e){return i(e)}).fail(function(){u.reject()}).done(function(e){u.resolve(e)});else{var a={};s(e,function(e,t){var n=i(e);return n.done(function(e){a[t]=e})}).fail(function(){u.reject()}).done(function(){u.resolve(a)})}return u.promise};return u}),n("reject",["require","./when","./collection/map","./collection/pluck","./forEach"],function(e){var t=e("./when"),n=e("./collection/map"),r=e("./collection/pluck"),i=e("./forEach"),s=function(e,s,o){var u=t.defer(),a=[];return s=n(s,function(e,t){return{index:t,value:e}}),i(s,function(e){return t(o(e.value)).fail(function(){a.push(e)})}).fail(function(){u.reject()}).done(function(){a=a.sort(function(e,t){return e.index-t.index}),a=r(a,"value"),u.resolve(a)}),u.promise};return s}),n("every",["require","./when","./forEach"],function(e){var t=e("./when"),n=e("./forEach"),r=function(e,r){var i=t.defer();return n(e,function(e){return t(r(e)).fail(function(){i.reject()})}).fail(function(){i.reject()}).done(function(){i.resolve()}),i.promise};return r}),n("waterfall",["require","./when","amd-utils/lang/isArray","amd-utils/lang/toArray","./anyToDeferred","amd-utils/object/keys","./collection/size"],function(e){var t=e("./when"),n=e("amd-utils/lang/isArray"),r=e("amd-utils/lang/toArray"),i=e("./anyToDeferred"),s=e("amd-utils/object/keys"),o=e("./collection/size"),u=function(e){var u=t.defer();arguments.length>1&&(e=r(arguments));if(!o(e))return u.reject(),u;var a=0,f;n(e)||(f=s(e));var l=function(){var t=r(arguments),s,c;n(e)?(c=a,s=e[c]):(c=f[a],s=e[c]),t.unshift(s),i.apply(this,t).fail(function(e){u.reject(c,e)}).done(function(t){a+=1,a===o(e)?u.resolve(t):l(t)})};return l(),u.promise};return u}),n("series",["require","./when","amd-utils/lang/isArray","amd-utils/lang/toArray","./anyToDeferred","./forEachSeries","./mapSeries"],function(e){var t=e("./when"),n=e("amd-utils/lang/isArray"),r=e("amd-utils/lang/toArray"),i=e("./anyToDeferred"),s=e("./forEachSeries"),o=e("./mapSeries"),u=function(e){var u=t.defer();arguments.length>1&&(e=r(arguments));if(n(e))o(e,function(e){return i(e)}).fail(function(){u.reject()}).done(function(e){u.resolve(e)});else{var a={};s(e,function(e,t){var n=i(e);return n.done(function(e){a[t]=e})}).fail(function(){u.reject()}).done(function(){u.resolve(a)})}return u.promise};return u}),n("rejectSeries",["require","./when","./collection/map","./collection/pluck","./forEachSeries"],function(e){var t=e("./when"),n=e("./collection/map"),r=e("./collection/pluck"),i=e("./forEachSeries"),s=function(e,s,o){var u=t.defer(),a=[];return s=n(s,function(e,t){return{index:t,value:e}}),i(s,function(e){return t(o(e.value)).fail(function(){a.push(e)})}).fail(function(){u.reject()}).done(function(){a=a.sort(function(e,t){return e.index-t.index}),a=r(a,"value"),u.resolve(a)}),u.promise};return s}),n("filter",["require","./when","./collection/map","./collection/pluck","./forEach"],function(e){var t=e("./when"),n=e("./collection/map"),r=e("./collection/pluck"),i=e("./forEach"),s=function(e,s,o){var u=t.defer(),a=[];return s=n(function(e,t){return{index:t,value:e}}),i(s,function(e){return t(o(e.value)).done(function(){a.push(e)})}).fail(function(){u.reject()}).done(function(){a=a.sort(function(e,t){return e.index-t.index}),a=r(a,"value"),u.resolve(a)}),u.promise};return s}),n("find",["require","./when","./forEach"],function(e){var t=e("./when"),n=e("./forEach"),r=function(e,r,i){var s=t.defer();return n(r,function(e){return t(i(e)).done(function(){s.resolve(e)})}).fail(function(){s.reject()}).done(function(){s.reject()}),s.promise};return r}),n("some",["require","./when","./forEach"],function(e){var t=e("./when"),n=e("./forEach"),r=function(e,r){var i=t.defer();return n(e,function(e){return t(r(e)).done(function(){i.resolve()})}).fail(function(){i.reject()}).done(function(){i.resolve()}),i.promise};return r}),n("findSeries",["require","./when","./forEachSeries"],function(e){var t=e("./when"),n=e("./forEachSeries"),r=function(e,r,i){var s=t.defer();return n(r,function(e){return t(i(e)).done(function(){s.resolve(e)})}).fail(function(){s.reject()}).done(function(){s.reject()}),s.promise};return r}),n("whilst",["require","./when"],function(e){var t=e("./when"),n=function(e,r){var i=t.defer();return e()?t(r()).fail(function(e){i.reject(e)}).done(function(){n(e,r)}):i.resolve(),i.promise};return n}),n("reduce",["require","./when","./forEachSeries"],function(e){var t=e("./when"),n=e("./forEachSeries"),r=function(e,r,i){var s=t.defer();return n(e,function(t,n){return i(r,t,n,e)}).fail(function(){s.reject()}).done(function(){s.resolve(r)}),s.promise};return r}),n("reduceRight",["require","./reduce","./collection/map","./collection/pluck"],function(e){var t=e("./reduce"),n=e("./collection/map"),r=e("./collection/pluck"),i=function(e,i,s){var o=n(e,function(e,t){return{index:t,value:e}}).reverse();return o=r(o,"value"),t(o,i,s)};return i}),window.Deferreds={when:t("when"),forEachSeries:t("forEachSeries"),filterSeries:t("filterSeries"),mapSeries:t("mapSeries"),forEach:t("forEach"),map:t("map"),until:t("until"),anyToDeferred:t("anyToDeferred"),parallel:t("parallel"),reject:t("reject"),every:t("every"),waterfall:t("waterfall"),series:t("series"),rejectSeries:t("rejectSeries"),filter:t("filter"),find:t("find"),some:t("some"),findSeries:t("findSeries"),whilst:t("whilst"),reduce:t("reduce"),reduceRight:t("reduceRight")}})();